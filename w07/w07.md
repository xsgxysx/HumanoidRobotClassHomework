# 第七周：田径跨栏

## 一、机器人运动
按照课程代码，已完成机器人跨栏、上台阶和巡线的代码运行，但巡线过程中转向动作需要调整。
![机器人巡线](1.mp4)

## 二、自问自答

### Q1:让机器人取色并巡线的代码是怎么实现的？

#### 取色阶段（视觉处理流程）

**1. 初始化与图像采集**
- 打开摄像头，开始视频流捕获
- 通过交互方式选取需要追踪的目标颜色

**2. 图像预处理**
- 缩放图片至合适尺寸，平衡处理速度与精度
- 应用高斯模糊滤波，减少图像噪声干扰

**3. 颜色空间转换与分割**
- 将图像从BGR色彩空间转换为LAB色彩空间（更适合颜色分割）
- 根据选定的目标颜色范围生成二值图像

**4. 区域分析与轮廓检测**
- 定义感兴趣区域(ROI)，从上到下遍历扫描
- 检测图像中的最大外轮廓，排除小面积噪声干扰
- 应用开运算形态学操作，进一步去除噪点

**5. 中心点定位**
- 计算轮廓的最小外接矩形
- 获取矩形的对角线中心点坐标
- 对连续多帧的中心点x坐标进行加权累加，得到稳定的巡线中心`line_center_x`
- 在图像上绘制外接矩形和加权中心点，便于调试观察

#### 巡线控制阶段（决策与执行）

**6. 运动决策逻辑**
- **初始状态**：设置`line_center_x`初始值为-1（表示未检测到线）
- **判断流程**：
  - 如果当前帧与上一帧中心点位置基本居中：执行**前进**指令
  - 如果检测到线在图像**右侧**：执行**右转**指令
  - 如果检测到线在图像**左侧**：执行**左转**指令

**7. 控制优化**
- 每次决策后添加短暂延时(0.01秒)，实现平滑的运动控制
- 通过加权累加算法减少中心点抖动，提高巡线稳定性
- 循环执行整个流程，实现持续的巡线跟踪

#### 技术特点

- **多帧融合**：通过加权累加避免单帧检测的抖动问题
- **自适应ROI**：从上到下的扫描方式适应不同线宽情况
- **色彩鲁棒性**：LAB色彩空间对光照变化更具适应性
- **实时控制**：简化的三状态决策机制确保快速响应

这套实现方案在保证准确性的同时优化了计算效率，适合嵌入式平台上的实时巡线应用。