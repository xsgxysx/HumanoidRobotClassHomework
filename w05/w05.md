# 第五周：机器人传感器

## 一、传感器功能模块

### 1.传感器
-准备一个触摸传感器，并通过4PIN线将其连接至树莓派扩展板上的GPI02122接口
-准备一个风扇模块，并通过4PIN线将其连接至树莓派扩展板上的GPIO7、8。

### 2.代码部分
```python
from gpiozero import OutputDevice, Button
from time import sleep
import hiwonder.ros_robot_controller_sdk as rrc

# 初始化板载蜂鸣器
board = rrc.Board()

# 初始化风扇控制引脚
fanPin1 = OutputDevice(8)  # BCM 8
fanPin2 = OutputDevice(7)  # BCM 7

# 初始化触摸传感器引脚
touch = Button(22)  # BCM 22

# 风扇状态变量
fan_state = False  # False表示关闭，True表示开启
touch_pressed = False  # 触摸传感器是否被按下

# 风扇控制函数
def set_fan(state):
    global fan_state
    fan_state = state
    
    if fan_state:
        # 开启风扇, 顺时针
        print("Turning fan ON")
        fanPin1.on()   # 输出高电平
        fanPin2.off()  # 输出低电平
        # 蜂鸣器提示音
        board.set_buzzer(1900, 0.2, 0.1, 1)  # 较高音调，短促
    else:
        # 关闭风扇
        print("Turning fan OFF")
        fanPin1.off()  # 输出低电平
        fanPin2.off()  # 输出低电平
        # 蜂鸣器提示音
        board.set_buzzer(1200, 0.2, 0.1, 1)  # 较低音调，短促

if __name__ == '__main__':
    try:
        # 初始状态，关闭风扇
        set_fan(False)
        print("Fan control system started. Press touch sensor to toggle fan.")
        
        while True:
            # 检测触摸传感器状态变化
            if touch.is_pressed and not touch_pressed:
                # 触摸传感器刚刚被按下
                touch_pressed = True
                # 切换风扇状态
                set_fan(not fan_state)
                # 添加短暂延时防止重复触发
                sleep(0.5)
            
            # 检测触摸传感器释放
            elif not touch.is_pressed and touch_pressed:
                touch_pressed = False
            
            # 短延时，降低CPU占用
            sleep(0.05)
            
    except KeyboardInterrupt:
        print("\nProgram interrupted. Turning fan off.")
        # 确保程序退出时关闭风扇
        set_fan(False)
    finally:
        # 清理资源
        set_fan(False)
        print("Program terminated.")
```

### 3.功能实现
该模块能在触摸传感器被按下时启动风扇并触发蜂鸣器，并在再次按下时触发蜂鸣器并关闭风扇，见下视频。
[点击观看视频](/w05.mp4) 

## 二、自问自答

### Q1: 触摸传感器的原理是什么？
**A1:**  
#### 概述
触摸传感器是一种能够检测物理接触或接近的电子元件。它取代了传统的机械开关，实现了无物理按键的交互方式。

#### 主要类型与工作原理

##### 1. 电阻式触摸传感器
* 结构：由两层带有透明导电涂层的柔性薄膜（如ITO）组成，中间由微小的绝缘隔点分开。
* 原理：当手指或触笔按压上层薄膜使其与下层薄膜接触时，电路导通。控制器通过检测电压变化，计算出触摸点的坐标（X, Y）。
* 特点：可被任何物体触发，成本低，但透光率相对较低，耐磨性较差。

##### 2. 电容式触摸传感器（最常见）
* 表面电容式：
 * 在玻璃表面镀上一层均匀的透明导电膜。
 * 在屏幕四角施加电压，形成均匀的电场。
 * 当手指（导体）触摸屏幕时，会与导电层形成一个耦合电容，“吸走”微小的电流。
 * 控制器通过检测四角电流的变化，计算出触摸点位置。

* 投射电容式（广泛应用于智能手机、平板）：
 * 在玻璃内表面蚀刻出纵横交错的、矩阵式的透明电极阵列（如菱形图案）。
 * 这些电极分别构成驱动线（Tx）和感应线（Rx），形成一个个交叉点（即电容节点）。
 * 工作时，控制器向驱动线发送特定信号，并从感应线接收信号。
 * 当手指（导体）接近时，会干扰电极间的电场，导致交叉点处的电容值发生微小变化。
 * 控制器通过扫描整个矩阵，检测每一个节点电容的细微变化，并通过算法精确计算出多个触摸点的位置。
* 特点：支持多点触控，高透光率，耐用性好，但只能被导体（如手指）触发。

##### 3. 其他类型
* 红外式：在屏幕边框设置红外发射管和接收管，形成红外线网格。触摸行为会遮挡住部分红外线，通过分析哪些光线被遮挡来确定位置。
* 表面声波式：在玻璃表面安装声波换能器，产生超声波在表面传播。触摸时会吸收部分声波，通过接收到的声波能量变化来确定位置。

#### 核心处理流程（以投射电容式为例）
1. 扫描：控制器快速扫描整个电极矩阵。
2. 检测：检测每个交叉点电容的微小变化量（ΔC）。
3. 数字转换：将模拟的电容变化信号转换为数字信号。
4. 滤波与计算：通过算法过滤环境噪声，计算出触摸点的精确坐标。
5. 输出：将坐标信息通过接口（如I²C, SPI）传输给主处理器（如手机CPU）。

#### 总结
触摸传感器的核心原理是将物理的“触摸”动作（压力、电容变化、光线遮挡等）转换为控制器可以识别的电信号变化（电压、电流、电容），再通过专门的算法处理，最终确定触摸位置并执行相应指令。​ 其中，电容式（尤其是投射电容式）因其优异的性能和体验，已成为消费电子领域的主流技术。

---

### Q2: 温湿度传感器的原理是什么？
**A2:**  
#### 概述
温湿度传感器是一种能够检测环境温度和相对湿度的电子设备。它将物理世界的温湿度信号转换为可被电子系统处理的电信号。

#### 温度检测原理

##### 1. 热敏电阻
* 原理：利用半导体金属氧化物材料的电阻值随温度变化而显著变化的特性。
* 类型：
 * NTC（负温度系数）：温度升高，电阻值减小。最为常见。
 * PTC（正温度系数）：温度升高，电阻值增大。
* 特点：成本低，灵敏度高，但非线性度较明显，需要校准。

##### 2. 电阻温度检测器（RTD）
* 原理：利用高纯度金属（如铂、铜、镍）的电阻值随温度升高而均匀增大的特性。铂电阻（Pt100/Pt1000）最为常用和精确。
* 特点：测量精度高、稳定性好、线性度佳，但成本高于热敏电阻。

##### 3. 热电偶
* 原理：基于塞贝克效应。将两种不同材质的金属导体一端焊接在一起形成测量端（热端），另一端为参考端（冷端）。当两端存在温差时，回路中会产生与温差成正比的电动势（电压）。
* 特点：测量温度范围极宽（-200℃至上千摄氏度），耐高温，但需要冷端补偿，信号较弱需放大。

##### 4. 数字温度传感器（如DS18B20）
* 原理：核心是一个硅半导体PN结。PN结的正向压降（Vf）与温度具有良好的线性关系。传感器内部集成电路（IC）直接测量这个电压差，并将其转换为数字信号输出。
* 特点：接口简单（单总线、I²C等），直接输出数字量，抗干扰能力强，精度较高。

#### 湿度检测原理

##### 1. 电容式湿度传感器（最常见）
* 结构：通常采用一种高分子聚合物薄膜作为介电质，该薄膜具有吸收和释放水分子的特性。薄膜上下两侧镀有金属电极，形成一个平板电容器。
* 原理：当环境湿度变化时，聚合物薄膜会吸收或释放水分子，导致其介电常数发生改变，从而引起电容值的变化。传感器通过测量这个电容值的变化来推算相对湿度。
* 特点：响应快、精度高、线性度好，是当前集成式温湿度传感器模块（如SHT3x， DHT22）的主流技术。

##### 2. 电阻式湿度传感器
* 原理：利用对湿度敏感的盐类或导电聚合物，其电阻值会随环境湿度的变化而改变。通过测量该材料的电阻值来测定湿度。
* 特点：成本较低，但线性度和长期稳定性不如电容式。

#### 集成式温湿度传感器（如SHT30， DHT11）
现代常见的温湿度传感器模块通常将温度传感元件（如PN结或热敏电阻）和湿度传感元件（电容式）集成在一起，并包含一个ASIC（专用集成电路）芯片。

工作流程：
1. 感知：温敏元件和湿敏元件分别感知环境的物理变化。
2. 转换：ASIC将元件的电阻或电容变化转换为与之对应的电压或频率信号。
3. 校准与补偿：利用存储在芯片内部的校准系数（通常在出厂时标定）对信号进行温度补偿和非线性校正，以得到高精度的测量值。例如，对湿度传感器读数进行温度补偿至关重要。
4. 数字化与输出：ASIC将校正后的模拟信号通过模数转换器（ADC）转换为数字信号，并通过标准接口（如I²C， SPI， 单总线）输出给微控制器（MCU）。

#### 总结
* 温度测量：主要基于材料的电阻、电压等电学参数随温度变化的物理效应。
* 湿度测量：主要基于对湿度敏感材料的介电常数（电容式）或电阻（电阻式）随水分含量变化的特性。
* 核心：将非电量的物理信号（温、湿度）转换为可测量的电信号，并通过内置的微处理器进行信号处理、补偿和数字化，最终提供稳定可靠的数字读数。
---

### Q3:超声波传感器的原理是什么？
**A3:**  
#### 概述
超声波传感器是一种利用超声波特性进行测距、检测的装置。其工作原理类似于蝙蝠的回声定位系统。

#### 工作原理（回波测距法）

##### 1. 发射超声波
传感器内部的压电晶片（换能器）在电信号的激励下产生振动，发射一束频率高于人耳听阈（通常为40kHz）的超声波。

##### 2. 传播与反射
超声波在空气中以约340m/s的速度直线传播，当遇到障碍物时，会被反射回来。

##### 3. 接收回波
同一传感器（或配套的接收传感器）的压电晶片接收到反射回来的超声波，将其转换成微弱的电信号。

##### 4. 时间测量与计算
内部处理器精确计算从超声波发射到接收回波所经过的时间（即“飞行时间”）。
根据公式计算距离：距离 = (声速 × 飞行时间) / 2
（除以2是因为声音传播了往返距离）

#### 核心组件
* 压电换能器：核心元件，实现电能与声能的相互转换。
* 控制电路：产生驱动信号、处理接收信号、计算时间。

#### 主要应用
* 距离测量：汽车倒车雷达、物位检测。
* 障碍物检测：机器人避障、自动门。
* 无损检测：材料内部缺陷检测。

#### 特点总结
* 优点：非接触测量、不受光线/颜色影响、成本较低。
* 局限：对柔软吸音材料效果差、测量速度有延迟、声速受温度影响（高端传感器会进行温度补偿）。
---
